# åç«¯æˆ¿æºæ¥å£é—®é¢˜è¯Šæ–­ - ä¸Šä¸‹æ–‡æ€»ç»“

## ğŸ“‹ é—®é¢˜æè¿°

**ç°è±¡**ï¼šå¾®ä¿¡å°ç¨‹åºå‰ç«¯æ— æ³•è·å–æˆ¿æºæ•°æ®ï¼Œæ˜¾ç¤ºç©ºåˆ—è¡¨

**åç«¯åœ°å€**ï¼š
```
https://express-17k0-204181-4-1371262252.sh.run.tcloudbase.com
```

**åç«¯ä»£ç ä½ç½®**ï¼š
```
C:\Users\Markus725\nottinghamdemo
```

---

## ğŸ” è¯Šæ–­è¿‡ç¨‹

### 1. æµè§ˆå™¨ç›´æ¥æµ‹è¯•ï¼ˆâœ… æˆåŠŸï¼‰

**è¯·æ±‚URL**ï¼š
```
https://express-17k0-204181-4-1371262252.sh.run.tcloudbase.com/api/properties?page=1&limit=10
```

**è¿”å›æ•°æ®**ï¼ˆæœ‰æ•°æ®ï¼‰ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "title": "ã€æµ‹è¯•ã€‘å¸‚ä¸­å¿ƒè±ªåå…¬å¯“",
        "description": "è¿™æ˜¯ä¸€ä¸ªé€šè¿‡SQLæ’å…¥çš„æµ‹è¯•æˆ¿æºï¼Œäº¤é€šä¾¿åˆ©ï¼Œé‡‡å…‰å¥½ã€‚",
        "type": "æ•´ç§Ÿ",
        "price": "2500.00",
        "deposit": null,
        "location": "è¯ºä¸æ±‰å¸‚ä¸­å¿ƒ",
        "address": "ç»´å¤šåˆ©äºšå¤§è¡—1å·",
        "bedrooms": 1,
        "bathrooms": 1,
        "area": "45.50",
        "floor": 5,
        "totalFloors": 20,
        "images": ["https://via.placeholder.com/300"],
        "tags": ["è¿‘åœ°é“", "ç‹¬å«", "æœå—"],
        "facilities": ["ç©ºè°ƒ", "æ´—è¡£æœº", "WiFi"],
        "contactName": "æˆ¿ä¸œæµ‹è¯•å‘˜",
        "contactPhone": "13800000000",
        "contactQRCode": null,
        "status": "available",
        "createdAt": "2025-12-03T21:52:47.000Z",
        "updatedAt": "2025-12-03T21:52:47.000Z"
      }
    ],
    "total": 1,
    "page": 1,
    "limit": 10
  }
}
```

---

### 2. å°ç¨‹åºå‰ç«¯æµ‹è¯•ï¼ˆâŒ å¤±è´¥ï¼‰

**è¯·æ±‚URL**ï¼ˆä»Networké¢æ¿ç¡®è®¤ï¼‰ï¼š
```
https://express-17k0-204181-4-1371262252.sh.run.tcloudbase.com/api/properties?page=1&limit=10
```

**å‰ç«¯Consoleæ—¥å¿—**ï¼š
```
è§¦å‘ä¸‹æ‹‰åˆ·æ–°
æ­£åœ¨åŠ è½½æˆ¿æºåˆ—è¡¨ï¼Œå‚æ•°ï¼š{page: 1, limit: 10}
ğŸ“¥ æ”¶åˆ°å“åº”: {statusCode: 200, data: {...}}
âœ… è§£ææˆåŠŸï¼Œè¿”å›data: {list: Array(0), total: 0, page: 1, limit: 10}
APIè¿”å›æ•°æ®ï¼š{list: [], total: 0, page: 1, limit: 10}
æˆ¿æºæ•°é‡ï¼š0
```

**è¿”å›æ•°æ®**ï¼ˆç©ºæ•°æ®ï¼‰ï¼š
```json
{
  "list": [],
  "total": 0,
  "page": 1,
  "limit": 10
}
```

---

## ğŸ¯ å…³é”®å‘ç°

### å¯¹æ¯”åˆ†æ

| æµ‹è¯•æ–¹å¼ | è¯·æ±‚URL | è¿”å›ç»“æœ |
|---------|---------|---------|
| æµè§ˆå™¨ | `/api/properties?page=1&limit=10` | âœ… æœ‰1æ¡æ•°æ® |
| å°ç¨‹åº | `/api/properties?page=1&limit=10` | âŒ ç©ºæ•°æ® |

**ç»“è®º**ï¼š
1. âœ… å‰ç«¯è¯·æ±‚æ­£ç¡®ï¼ˆURLç›¸åŒï¼‰
2. âœ… åç«¯æ¥å£è¿è¡Œæ­£å¸¸
3. âœ… æ•°æ®åº“æœ‰æ•°æ®
4. âŒ **å°ç¨‹åºè¯·æ±‚æ—¶åç«¯è¿”å›ç©ºæ•°æ®**

**å¯èƒ½åŸå› **ï¼š
- åç«¯æ ¹æ®è¯·æ±‚æ¥æºï¼ˆUser-Agent / Refererï¼‰è¿‡æ»¤æ•°æ®ï¼Ÿ
- åç«¯æœ‰Tokenè®¤è¯ä½†å°ç¨‹åºæ²¡ä¼ ï¼Ÿ
- åç«¯å¯¹å°ç¨‹åºè¯·æ±‚æœ‰ç‰¹æ®Šå¤„ç†ï¼Ÿ
- åç«¯æ—¥å¿—å¯èƒ½æ˜¾ç¤ºä¸åŒçš„æŸ¥è¯¢æ¡ä»¶ï¼Ÿ

---

## ğŸ“‚ åç«¯ä»£ç ç»“æ„ï¼ˆéœ€è¦æŸ¥çœ‹ï¼‰

**åç«¯é¡¹ç›®ä½ç½®**ï¼š
```
C:\Users\Markus725\nottinghamdemo
```

**éœ€è¦æŸ¥çœ‹çš„å…³é”®æ–‡ä»¶**ï¼š
1. ä¸»å…¥å£æ–‡ä»¶ï¼š`app.js` æˆ– `index.js`
2. è·¯ç”±æ–‡ä»¶ï¼š`routes/properties.js` æˆ– `routes/api.js`
3. æ§åˆ¶å™¨ï¼š`controllers/propertyController.js`

**æŸ¥æ‰¾æ–¹æ³•**ï¼š
åœ¨åç«¯é¡¹ç›®ä¸­æœç´¢ `'/api/properties'` æˆ– `GET.*properties`

---

## ğŸ”§ å‰ç«¯ä»£ç ï¼ˆå·²ä¿®å¤ï¼‰

**å‰ç«¯APIè°ƒç”¨**ï¼ˆ`pages/index/index.js`ï¼‰ï¼š
```javascript
const data = await api.getPropertyList({
  page: this.data.page,
  limit: 10
})
```

**APIå°è£…**ï¼ˆ`utils/api.js`ï¼‰ï¼š
```javascript
const BASE_URL = 'https://express-17k0-204181-4-1371262252.sh.run.tcloudbase.com'

const request = (url, options = {}) => {
  return new Promise((resolve, reject) => {
    const token = wx.getStorageSync('token')
    
    wx.request({
      url: BASE_URL + url,
      method: options.method || 'GET',
      data: options.data || {},
      header: {
        'Content-Type': 'application/json',
        ...(token ? { 'Authorization': `Bearer ${token}` } : {})
      },
      success: (res) => {
        if (res.statusCode === 200 && res.data.code === 200) {
          resolve(res.data.data)
        }
      }
    })
  })
}

const getPropertyList = (params) => {
  return request('/api/properties', {
    method: 'GET',
    data: params
  })
}
```

---

## ğŸ¯ éœ€è¦åç«¯å¼€å‘äººå‘˜æ£€æŸ¥

### 1. æŸ¥çœ‹åç«¯æ—¥å¿—
å°ç¨‹åºè¯·æ±‚æ—¶ï¼Œåç«¯æ—¥å¿—æ˜¾ç¤ºï¼š
- æ”¶åˆ°çš„è¯·æ±‚å‚æ•°æ˜¯ä»€ä¹ˆï¼Ÿ
- æ‰§è¡Œäº†ä»€ä¹ˆSQLæŸ¥è¯¢ï¼Ÿ
- æŸ¥è¯¢è¿”å›äº†å¤šå°‘æ¡æ•°æ®ï¼Ÿ

### 2. æ£€æŸ¥è¯·æ±‚å¤´å·®å¼‚
æµè§ˆå™¨è¯·æ±‚å’Œå°ç¨‹åºè¯·æ±‚çš„Headeræ˜¯å¦æœ‰å·®å¼‚ï¼Ÿ
- User-Agent
- Referer
- Authorization

### 3. æ£€æŸ¥åç«¯ä»£ç é€»è¾‘

**ç¤ºä¾‹éœ€è¦æ£€æŸ¥çš„åœ°æ–¹**ï¼š
```javascript
// è¿™æ˜¯å¯èƒ½çš„é—®é¢˜ä»£ç ç¤ºä¾‹
router.get('/api/properties', async (req, res) => {
  const { page, limit, type } = req.query
  
  // å¯èƒ½çš„é—®é¢˜1ï¼štypeå‚æ•°å¤„ç†
  let query = {}
  if (type !== undefined) {  // âŒ undefinedä¹Ÿä¼šè¿›å…¥
    query.type = type
  }
  
  // å¯èƒ½çš„é—®é¢˜2ï¼šè¯·æ±‚æ¥æºé™åˆ¶
  if (req.headers['user-agent'].includes('MicroMessenger')) {
    // ç‰¹æ®Šå¤„ç†ï¼Ÿ
  }
  
  // å¯èƒ½çš„é—®é¢˜3ï¼šTokenéªŒè¯
  if (!req.headers.authorization) {
    return res.json({ code: 200, data: { list: [], total: 0 } })
  }
  
  const properties = await Property.find(query)
  
  res.json({
    code: 200,
    data: {
      list: properties,
      total: properties.length
    }
  })
})
```

---

## ğŸ“ å»ºè®®çš„è°ƒè¯•æ­¥éª¤

### åç«¯æ·»åŠ è¯¦ç»†æ—¥å¿—

```javascript
router.get('/api/properties', async (req, res) => {
  console.log('==================')
  console.log('æ”¶åˆ°æˆ¿æºåˆ—è¡¨è¯·æ±‚')
  console.log('è¯·æ±‚æ¥æº:', req.headers['user-agent'])
  console.log('è¯·æ±‚å‚æ•°:', req.query)
  console.log('Token:', req.headers.authorization)
  console.log('==================')
  
  // ... ç°æœ‰é€»è¾‘
  
  console.log('æŸ¥è¯¢æ¡ä»¶:', query)
  console.log('æŸ¥è¯¢ç»“æœ:', properties.length, 'æ¡')
  console.log('è¿”å›æ•°æ®:', { list: properties.length, total })
})
```

### å¯¹æ¯”æµ‹è¯•

1. **ç”¨Postmanæ¨¡æ‹Ÿå°ç¨‹åºè¯·æ±‚**ï¼š
   - URLç›¸åŒ
   - Headerä¸­æ·»åŠ å°ç¨‹åºçš„User-Agent
   - çœ‹æ˜¯å¦ä¹Ÿè¿”å›ç©ºæ•°æ®

2. **ä¸´æ—¶ç§»é™¤æ‰€æœ‰è¿‡æ»¤æ¡ä»¶**ï¼š
   ```javascript
   // ä¸´æ—¶æµ‹è¯•ï¼šç›´æ¥è¿”å›æ‰€æœ‰æ•°æ®
   const properties = await Property.find({})
   ```

---

## ğŸš€ ä¸‹ä¸€æ­¥

è¯·æ–°çš„Antigravityä¼šè¯ï¼š
1. æŸ¥çœ‹åç«¯ä»£ç ä¸­ `GET /api/properties` çš„å®ç°
2. æ‰¾å‡ºä¸ºä»€ä¹ˆå°ç¨‹åºè¯·æ±‚è¿”å›ç©ºæ•°æ®
3. æä¾›ä¿®å¤æ–¹æ¡ˆ

**å…³é”®æ–‡ä»¶è·¯å¾„**ï¼š
- åç«¯ä»£ç ï¼š`C:\Users\Markus725\nottinghamdemo`
- æœç´¢å…³é”®è¯ï¼š`'/api/properties'` æˆ– `router.get('/properties'`
