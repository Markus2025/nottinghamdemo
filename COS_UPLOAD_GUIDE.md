# ğŸ“¸ è…¾è®¯äº‘COSå›¾ç‰‡ä¸Šä¼ é…ç½®æŒ‡å—

## ğŸ¯ åŠŸèƒ½è¯´æ˜

AdminJSåå°ç®¡ç†ç³»ç»Ÿç°å·²é›†æˆè…¾è®¯äº‘COSå›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡æ‹–æ‹½æˆ–ç‚¹å‡»ä¸Šä¼ æˆ¿æºå›¾ç‰‡ã€‚

---

## ğŸ”§ é…ç½®æ­¥éª¤

### æ­¥éª¤1ï¼šå¼€é€šè…¾è®¯äº‘COS

1. ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°ï¼šhttps://console.cloud.tencent.com/cos5
2. ç‚¹å‡»ã€Œå­˜å‚¨æ¡¶åˆ—è¡¨ã€â†’ã€Œåˆ›å»ºå­˜å‚¨æ¡¶ã€

**é…ç½®å»ºè®®**ï¼š
```
åç§°ï¼šnottingham-propertiesï¼ˆæˆ–å…¶ä»–åç§°ï¼‰
æ‰€å±åœ°åŸŸï¼šä¸Šæµ·ï¼ˆap-shanghaiï¼‰æ¨è
è®¿é—®æƒé™ï¼šå…¬æœ‰è¯»ç§æœ‰å†™
```

3. ç‚¹å‡»ã€Œç¡®å®šã€åˆ›å»º

### æ­¥éª¤2ï¼šé…ç½®CORSï¼ˆè·¨åŸŸè®¿é—®ï¼‰

1. è¿›å…¥åˆšåˆ›å»ºçš„å­˜å‚¨æ¡¶
2. å·¦ä¾§èœå•ã€Œå®‰å…¨ç®¡ç†ã€â†’ã€Œè·¨åŸŸè®¿é—®CORSè®¾ç½®ã€
3. ç‚¹å‡»ã€Œæ·»åŠ è§„åˆ™ã€

**é…ç½®å‚æ•°**ï¼š
```
æ¥æº Originï¼š*
æ“ä½œ Methodsï¼šGET, PUT, POST, DELETE, HEAD
Allow-Headersï¼š*
Expose-Headersï¼šETag
è¶…æ—¶ Max-Ageï¼š600
```

4. ç‚¹å‡»ã€Œä¿å­˜ã€

### æ­¥éª¤3ï¼šè·å–å¯†é’¥

1. è®¿é—®ï¼šhttps://console.cloud.tencent.com/cam/capi
2. ç‚¹å‡»ã€Œæ–°å»ºå¯†é’¥ã€ï¼ˆæˆ–ä½¿ç”¨ç°æœ‰å¯†é’¥ï¼‰
3. è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š
   - SecretIdï¼ˆä¾‹å¦‚ï¼šAKIDxxxxxxxxxxxxxï¼‰
   - SecretKeyï¼ˆä¾‹å¦‚ï¼šxxxxxxxxxxxxxï¼‰

### æ­¥éª¤4ï¼šé…ç½®ç¯å¢ƒå˜é‡

åœ¨å¾®ä¿¡äº‘æ‰˜ç®¡çš„ç¯å¢ƒå˜é‡ä¸­æ·»åŠ ï¼š

| å˜é‡å | å€¼ | è¯´æ˜ |
|-------|-----|------|
| `COS_SECRET_ID` | æ‚¨çš„SecretId | APIå¯†é’¥ID |
| `COS_SECRET_KEY` | æ‚¨çš„SecretKey | APIå¯†é’¥ |
| `COS_BUCKET` | nottingham-properties-1234567890 | å­˜å‚¨æ¡¶åç§°ï¼ˆå®Œæ•´ï¼‰ |
| `COS_REGION` | ap-shanghai | åœ°åŸŸï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸Šæµ·ï¼‰ |
| `COS_ENDPOINT` | https://cos.ap-shanghai.myqcloud.com | è®¿é—®åŸŸåï¼ˆå¯é€‰ï¼‰ |

**æ³¨æ„**ï¼š
- `COS_BUCKET` éœ€è¦å¡«å†™å®Œæ•´åç§°ï¼Œæ ¼å¼ï¼š`{bucketåç§°}-{APPID}`
- APPIDå¯ä»¥åœ¨å­˜å‚¨æ¡¶è¯¦æƒ…é¡µæŸ¥çœ‹

**ç¯å¢ƒå˜é‡é…ç½®è·¯å¾„**ï¼š
```
å¾®ä¿¡äº‘æ‰˜ç®¡æ§åˆ¶å° â†’ æ‚¨çš„æœåŠ¡ â†’ æœåŠ¡é…ç½® â†’ ç¯å¢ƒå˜é‡
```

---

## ğŸ¨ ä½¿ç”¨æ–¹æ³•

### åœ¨åå°ç®¡ç†ç³»ç»Ÿä¸­ä¸Šä¼ å›¾ç‰‡

1. ç™»å½•åå°ï¼š`https://your-domain.com/admin`
2. è¿›å…¥ã€Œæˆ¿æºç®¡ç†ã€
3. åˆ›å»ºæˆ–ç¼–è¾‘æˆ¿æº
4. æ‰¾åˆ°ã€ŒImage Filesã€å­—æ®µ
5. ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡

**ä¸Šä¼ ç•Œé¢**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Image Files                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚ â”‚ ğŸ–¼ï¸    â”‚  æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œ      â”‚
â”‚ â”‚ æˆ–ç‚¹å‡» â”‚  æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                              â”‚
â”‚ æ”¯æŒæ ¼å¼ï¼šJPG, PNG, GIF, WebPâ”‚
â”‚ æœ€å¤§å¤§å°ï¼š5MB                 â”‚
â”‚ å¯ä¸Šä¼ å¤šå¼                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸Šä¼ åçš„æ•ˆæœ

ä¸Šä¼ æˆåŠŸåï¼š
- âœ… å›¾ç‰‡ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ°COS
- âœ… `imageFiles` å­—æ®µå­˜å‚¨æ–‡ä»¶ä¿¡æ¯
- âœ… `images` å­—æ®µè‡ªåŠ¨å¡«å……å…¬ç½‘URLæ•°ç»„
- âœ… å°ç¨‹åºå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›URL

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "imageFiles": [
    {
      "key": "properties/1/1701234567890-room1.jpg",
      "bucket": "nottingham-properties-1234567890"
    }
  ],
  "images": [
    "https://nottingham-properties-1234567890.cos.ap-shanghai.myqcloud.com/properties/1/1701234567890-room1.jpg"
  ]
}
```

---

## ğŸ” éªŒè¯é…ç½®

### æ–¹æ³•1ï¼šåå°æµ‹è¯•ä¸Šä¼ 

1. ç™»å½•åå°ç®¡ç†ç³»ç»Ÿ
2. åˆ›å»ºæµ‹è¯•æˆ¿æº
3. ä¸Šä¼ ä¸€å¼ å›¾ç‰‡
4. æŸ¥çœ‹æ˜¯å¦ä¸Šä¼ æˆåŠŸ

### æ–¹æ³•2ï¼šç›´æ¥è®¿é—®COS

1. ä¸Šä¼ æˆåŠŸåï¼Œå¤åˆ¶å›¾ç‰‡URL
2. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€URL
3. åº”è¯¥èƒ½çœ‹åˆ°å›¾ç‰‡

---

## ğŸ’° è´¹ç”¨è¯´æ˜

### å…è´¹é¢åº¦ï¼ˆæ¯æœˆï¼‰
- å­˜å‚¨ç©ºé—´ï¼š50GB
- ä¸‹è¡Œæµé‡ï¼š10GB
- è¯·æ±‚æ¬¡æ•°ï¼š100ä¸‡æ¬¡

### è¶…å‡ºåæŒ‰é‡è®¡è´¹
- å­˜å‚¨ï¼š0.099å…ƒ/GB/æœˆ
- CDNæµé‡ï¼š0.18å…ƒ/GB
- è¯·æ±‚æ¬¡æ•°ï¼š0.01å…ƒ/ä¸‡æ¬¡

**é¢„ä¼°æˆæœ¬**ï¼š
- 100ä¸ªæˆ¿æºï¼Œæ¯ä¸ª5å¼ å›¾ç‰‡
- æ¯å¼ å›¾ç‰‡500KB
- æ¯æœˆ1000æ¬¡è®¿é—®
- **è´¹ç”¨çº¦ï¼š1-2å…ƒ/æœˆ**

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: ä¸Šä¼ å¤±è´¥ï¼Œæç¤º"AccessDenied"
**A**: æ£€æŸ¥å¯†é’¥æ˜¯å¦æ­£ç¡®ï¼Œå­˜å‚¨æ¡¶æƒé™æ˜¯å¦ä¸º"å…¬æœ‰è¯»ç§æœ‰å†™"

### Q2: å›¾ç‰‡ä¸Šä¼ æˆåŠŸä½†æ— æ³•è®¿é—®
**A**: æ£€æŸ¥CORSé…ç½®ï¼Œç¡®ä¿å…è®¸è·¨åŸŸè®¿é—®

### Q3: å›¾ç‰‡æ˜¾ç¤ºå¾ˆæ…¢
**A**: å¯ä»¥å¼€å¯COSçš„CDNåŠ é€Ÿ

### Q4: å¦‚ä½•åˆ é™¤å·²ä¸Šä¼ çš„å›¾ç‰‡ï¼Ÿ
**A**: 
- æ–¹å¼1ï¼šåœ¨AdminJSä¸­åˆ é™¤æˆ¿æºä¼šè‡ªåŠ¨åˆ é™¤å…³è”å›¾ç‰‡
- æ–¹å¼2ï¼šåœ¨COSæ§åˆ¶å°æ‰‹åŠ¨åˆ é™¤

### Q5: å¯ä»¥ä¸Šä¼ å¤šå¤§çš„å›¾ç‰‡ï¼Ÿ
**A**: å½“å‰é™åˆ¶5MBï¼Œå¯ä»¥åœ¨`src/config/upload.js`ä¸­ä¿®æ”¹

### Q6: æ”¯æŒå“ªäº›å›¾ç‰‡æ ¼å¼ï¼Ÿ
**A**: JPG, JPEG, PNG, GIF, WebP

---

## ğŸ”§ é«˜çº§é…ç½®

### ä¿®æ”¹ä¸Šä¼ é™åˆ¶

ç¼–è¾‘ `src/config/upload.js`ï¼š

```javascript
validation: {
  maxSize: 10 * 1024 * 1024, // æ”¹ä¸º10MB
  mimeTypes: [
    'image/jpeg', 
    'image/png', 
    'image/gif', 
    'image/webp',
    'image/svg+xml'  // æ·»åŠ SVGæ”¯æŒ
  ],
},
```

### è‡ªå®šä¹‰å­˜å‚¨è·¯å¾„

```javascript
uploadPath: (record, filename) => {
  const date = new Date();
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  return `properties/${year}/${month}/${Date.now()}-${filename}`;
},
```

### å¯ç”¨CDNåŠ é€Ÿ

1. åœ¨COSæ§åˆ¶å°å¼€å¯CDN
2. ä¿®æ”¹`COS_ENDPOINT`ç¯å¢ƒå˜é‡ä¸ºCDNåŸŸå

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- è…¾è®¯äº‘COSæ–‡æ¡£ï¼šhttps://cloud.tencent.com/document/product/436
- AdminJS Uploadæ–‡æ¡£ï¼šhttps://docs.adminjs.co/

---

**é…ç½®å®Œæˆåï¼Œè¯·é‡æ–°éƒ¨ç½²åº”ç”¨ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼**
