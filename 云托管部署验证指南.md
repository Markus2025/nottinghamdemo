# 微信云托管部署验证指南

## ✅ 已完成工作

1. **代码开发**: 完成组队成员备注功能的所有后端实现
2. **Git 提交**: commit 9ff9a83 已提交
3. **代码推送**: 已推送到 GitHub (master 分支)
4. **触发部署**: 微信云托管将自动检测更新并开始部署

---

## 📋 部署后必做事项

### ⚠️ 重要：执行数据库迁移

由于添加了新字段，需要在云数据库中执行迁移 SQL：

1. **登录微信云托管控制台**
   - 访问：https://cloud.weixin.qq.com/
   - 进入您的服务

2. **连接到云数据库**
   - 方式一：使用云托管控制台的数据库管理工具
   - 方式二：使用本地数据库客户端连接云数据库

3. **执行迁移 SQL**
   ```sql
   ALTER TABLE TeamMembers 
   ADD COLUMN note VARCHAR(500) DEFAULT '' COMMENT '成员个人备注';
   ```

4. **验证字段添加成功**
   ```sql
   DESCRIBE TeamMembers;
   -- 应该能看到 note 字段
   ```

---

## 🔍 部署状态检查

### 1. 查看云托管部署进度

1. 登录微信云托管控制台
2. 进入"服务管理" → "版本管理"
3. 查看最新版本的部署状态
4. 等待状态变为"运行中"

### 2. 查看部署日志

在控制台可以查看：
- 构建日志
- 启动日志
- 运行日志

关注是否有错误信息。

---

## 🧪 部署成功后的测试

### 测试 1: 健康检查

```bash
curl https://YOUR_CLOUD_HOSTING_URL/
```

**预期响应**：
```json
{
  "code": 200,
  "message": "Nottingham房源小程序API服务运行中",
  "version": "1.0.0"
}
```

### 测试 2: 获取组队详情

```bash
curl -X GET 'https://YOUR_CLOUD_HOSTING_URL/api/teams/1' \
  -H 'Authorization: Bearer YOUR_TOKEN'
```

**检查**：响应中的 members 应该包含 `note` 字段

### 测试 3: 更新成员备注

```bash
curl -X PUT 'https://YOUR_CLOUD_HOSTING_URL/api/teams/1/members/1/note' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: application/json' \
  -d '{"note":"测试备注"}'
```

**预期**：返回 200 成功

---

## 📱 前端集成测试

### 1. 确认前端配置

小程序 `utils/api.js`：
```javascript
const USE_MOCK_DATA = false  // 确保是 false
```

### 2. 测试流程

1. **打开微信开发者工具**
2. **清除缓存**：工具 → 清除缓存 → 清除所有缓存
3. **重新编译**
4. **测试组队详情页**：
   - 进入"组队" → "我的组队"
   - 点击组队卡片
   - 查看详情页是否正常显示
   - 测试编辑备注功能

---

## ❓ 常见问题

### 问题 1: 部署后 API 返回 500 错误

**可能原因**：
- 数据库迁移未执行
- 环境变量配置问题

**解决方法**：
1. 检查云托管日志
2. 确认数据库迁移已执行
3. 验证环境变量配置

### 问题 2: note 字段返回 null 或 undefined

**原因**：数据库迁移未执行

**解决**：
```sql
-- 检查字段
DESCRIBE TeamMembers;

-- 如果不存在，执行迁移
ALTER TABLE TeamMembers 
ADD COLUMN note VARCHAR(500) DEFAULT '' COMMENT '成员个人备注';
```

### 问题 3: 前端无法连接到后端

**检查**：
1. 云托管服务是否正常运行
2. 小程序的服务器域名配置
3. 网络请求是否正确

---

## 📊 验证清单

完成部署后，请确认：

- [ ] 云托管部署成功（状态：运行中）
- [ ] 数据库迁移已执行
- [ ] 健康检查 API 正常
- [ ] GET /api/teams/:teamId 返回正确数据
- [ ] PUT /api/teams/:teamId/members/:userId/note 可以更新备注
- [ ] 前端可以正常访问组队详情页
- [ ] 前端可以正常编辑备注
- [ ] 数据持久化成功

---

## 🎉 全部完成！

部署并验证成功后，新功能就可以正式使用了！

如有任何问题，请检查：
1. 云托管部署日志
2. 数据库字段是否添加
3. API 测试结果
4. 前端控制台日志
